<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Unraid USB Controller Passthrough - VM hot swap USB | ExitCode0</title>
<meta name=keywords content="libvert,UNRAID,USB hot swap"><meta name=description content="

For the longest time, I have been running VMs on my Unraid server and had the need to passthrough USB devices. I will be the first to admit that I have too many computers and a shrink might classify it as an addition. Coupled with my quest for a clutter-free desk, I have been faced with the issue of swapping USB devices like a keyboard and mouse, from one machine to another Unraid virtual machine (vm)."><meta name=author content="Tom"><link rel=canonical href=https://exitcode0.net/posts/unraid-usb-controller-passthrough-vm-hot-swap-usb/><link crossorigin=anonymous href=/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z+V9+cO1A=" rel="preload stylesheet" as=style><link rel=icon href=https://exitcode0.net/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://exitcode0.net/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://exitcode0.net/favicon-32x32.png><link rel=apple-touch-icon href=https://exitcode0.net/apple-touch-icon.png><link rel=mask-icon href=https://exitcode0.net/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://exitcode0.net/posts/unraid-usb-controller-passthrough-vm-hot-swap-usb/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7745507566538945" crossorigin=anonymous></script><script data-name=BMC-Widget data-cfasync=false src=https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js data-id=exit data-description="Support me on Buy me a coffee!" data-message="Buy me a coffee" data-color=#FF813F data-position=Right data-x_margin=18 data-y_margin=165></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-EDE9MPZR9T"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-EDE9MPZR9T")}</script><meta property="og:title" content="Unraid USB Controller Passthrough - VM hot swap USB"><meta property="og:description" content="

For the longest time, I have been running VMs on my Unraid server and had the need to passthrough USB devices. I will be the first to admit that I have too many computers and a shrink might classify it as an addition. Coupled with my quest for a clutter-free desk, I have been faced with the issue of swapping USB devices like a keyboard and mouse, from one machine to another Unraid virtual machine (vm)."><meta property="og:type" content="article"><meta property="og:url" content="https://exitcode0.net/posts/unraid-usb-controller-passthrough-vm-hot-swap-usb/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-03-03T16:33:30+00:00"><meta property="article:modified_time" content="2021-03-03T16:33:30+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Unraid USB Controller Passthrough - VM hot swap USB"><meta name=twitter:description content="

For the longest time, I have been running VMs on my Unraid server and had the need to passthrough USB devices. I will be the first to admit that I have too many computers and a shrink might classify it as an addition. Coupled with my quest for a clutter-free desk, I have been faced with the issue of swapping USB devices like a keyboard and mouse, from one machine to another Unraid virtual machine (vm)."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://exitcode0.net/posts/"},{"@type":"ListItem","position":2,"name":"Unraid USB Controller Passthrough - VM hot swap USB","item":"https://exitcode0.net/posts/unraid-usb-controller-passthrough-vm-hot-swap-usb/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Unraid USB Controller Passthrough - VM hot swap USB","name":"Unraid USB Controller Passthrough - VM hot swap USB","description":" For the longest time, I have been running VMs on my Unraid server and had the need to passthrough USB devices. I will be the first to admit that I have too many computers and a shrink might classify it as an addition. Coupled with my quest for a clutter-free desk, I have been faced with the issue of swapping USB devices like a keyboard and mouse, from one machine to another Unraid virtual machine (vm).\n","keywords":["libvert","UNRAID","USB hot swap"],"articleBody":" For the longest time, I have been running VMs on my Unraid server and had the need to passthrough USB devices. I will be the first to admit that I have too many computers and a shrink might classify it as an addition. Coupled with my quest for a clutter-free desk, I have been faced with the issue of swapping USB devices like a keyboard and mouse, from one machine to another Unraid virtual machine (vm).\nSolving the physical component of changing the device from one machine to another is easy. Just acquire a USB switcher/KVM such as this:\nA simple USB switch / KVM There are hundreds of these and they are relatively cheap. However, the real problem is that when you switch the keyboard and mouse into the Unraid server (in an attempt to ‘plug’ them into a VM), they are assigned to the Unraid host, not a VM.\nIn the past I have developed a way to use a Pi with a button attached to send virsh commands to Unraid, connecting the USB device to a particular VM. This worked well, but required me to push 2 buttons; one to physically switch the USB devices, followed by another to run the virsh command from a Pi – only mildly irritating. The main irritation was the limit to the number of times you could ‘attach’ a USB device to a VM before its virtual hub became full. So I tried removing the device before attaching it (all using virsh) and ultimately ran out of skill and/or patients.\nWhat I really needed was a USB controller to be permanently pass through to the VM. Then, whenever a device was plugged into that USB controller, it would be connecting to the VM and never the Unraid host. And so then next issue (which we are about to solve), which USB controller and how to pass it through?\nInateck Superspeed 4 Ports PCI-E to USB 3.0 I found the ‘Inateck Superspeed 4 Ports PCI-E to USB 3.0’ on Amazon and took a bit of an educated guess on whether I would be able to pass it through. The supported card/controllers list is very thin on the ground.\nImportantly, it used the Fresco FL1100 series chipset, which to the best of my reading, can be passed through to a VM. It is also popular with crypto mining for this reason.\nHow to pass through the USB controller Prerequisites:\nA working VM CPU and Bios that supports VT-d (and has it enabled) USB pcie card Find the device identifier With the USB card plugged in, we must first identify it. Sadly, I cannot confirm that this card will show up in its own IOMMU group as it did for me, so your mileage may vary. My card shows up in its own IOMMU group and I can see its ID: 1b73:1100.\nFresco FL1100 USB Controller\nEdt Boot config Now we need to tell Unraid to ignore/backlist the device by its ID, so that it will be available for passthrough. Go to the Main page, and click on your flash device to start editing the Syslinux boot config:\nUnder ‘kernel /bzimage‘ paste the following line, replacing the ID with yours appropriately:\nappend initrd=/bzroot pci-stub.ids=1b73:1100 Save this, then it is time to reboot.\nEdit the VM Now we can edit the VM (with it powered off) and add the pcie USB card:\nSUCCESS!\nYou should now have true USB hot swap in your UNRAID VM. I have had this working reliably for a number of weeks at this point, the passthrough config survives a complete system reboot and UNRAID upgrades.\n","wordCount":"605","inLanguage":"en","datePublished":"2021-03-03T16:33:30Z","dateModified":"2021-03-03T16:33:30Z","author":{"@type":"Person","name":"Tom"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://exitcode0.net/posts/unraid-usb-controller-passthrough-vm-hot-swap-usb/"},"publisher":{"@type":"Organization","name":"ExitCode0","logo":{"@type":"ImageObject","url":"https://exitcode0.net/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://exitcode0.net/ accesskey=h title="ExitCode0 (Alt + H)">ExitCode0</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://datasolace.com/ title=DataSolace><span>DataSolace</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=https://exitcode0.net/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://exitcode0.net/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://exitcode0.net/privacy/ title=Privacy><span>Privacy</span></a></li><li><a href=https://exitcode0.net/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://exitcode0.net/>Home</a>&nbsp;»&nbsp;<a href=https://exitcode0.net/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Unraid USB Controller Passthrough - VM hot swap USB</h1><div class=post-meta><span title='2021-03-03 16:33:30 +0000 UTC'>March 3, 2021</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;Tom</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#inateck-superspeed-4-ports-pci-e-to-usb-30 aria-label="Inateck Superspeed 4 Ports PCI-E to USB 3.0">Inateck Superspeed 4 Ports PCI-E to USB 3.0</a></li><li><a href=#how-to-pass-through-the-usb-controller aria-label="How to pass through the USB controller">How to pass through the USB controller</a><ul><li><a href=#find-the-device-identifier aria-label="Find the device identifier">Find the device identifier</a></li><li><a href=#edt-boot-config aria-label="Edt Boot config">Edt Boot config</a></li><li><a href=#edit-the-vm aria-label="Edit the VM">Edit the VM</a></li></ul></li></ul></div></details></div><div class=post-content><p><img loading=lazy src="https://i1.wp.com/images-na.ssl-images-amazon.com/images/I/81koU3VBFOL._AC_SL1500_.jpg?resize=228%2C342&amp;ssl=1" alt="Unraid USB Controller Passthrough - Fresco FL1100">
For the longest time, I have been running VMs on my Unraid server and had the need to passthrough USB devices. I will be the first to admit that I have too many computers and a shrink might classify it as an addition. Coupled with my quest for a clutter-free desk, I have been faced with the issue of swapping USB devices like a keyboard and mouse, from one machine to another Unraid virtual machine (vm).</p><p>Solving the physical component of changing the device from one machine to another is easy. Just acquire a USB switcher/KVM such as this:</p><p><a href="https://www.amazon.co.uk/UGREEN-Sharing-Keyboard-Scanner-Printer-Black/dp/B01N6GD9JO/ref=sr_1_3?dchild=1&amp;keywords=usb+kvm&amp;qid=1614788907&amp;sr=8-3" title="https://www.amazon.co.uk/UGREEN-Sharing-Keyboard-Scanner-Printer-Black/dp/B01N6GD9JO/ref=sr_1_3?dchild=1&amp;keywords=usb+kvm&amp;qid=1614788907&amp;sr=8-3"><img loading=lazy src="https://i2.wp.com/images-na.ssl-images-amazon.com/images/I/51LZkoc-DUL._SL1001_.jpg?resize=501%2C501&amp;ssl=1" alt>
</a>A simple USB switch / KVM
There are hundreds of these and they are relatively cheap. However, the real problem is that when you switch the keyboard and mouse into the Unraid server (in an attempt to ‘plug’ them into a VM), they are assigned to the Unraid host, not a VM.</p><p>In the past I have developed a way to use a Pi with a button attached to send <a href=https://linux.die.net/man/1/virsh title=https://linux.die.net/man/1/virsh>virsh</a> commands to Unraid, connecting the USB device to a particular VM. This worked well, but required me to push 2 buttons; one to physically switch the USB devices, followed by another to run the <a href=https://linux.die.net/man/1/virsh title=https://linux.die.net/man/1/virsh>virsh</a> command from a Pi – only mildly irritating. The main irritation was the limit to the number of times you could ‘attach’ a USB device to a VM before its virtual hub became full. So I tried removing the device before attaching it (all using virsh) and ultimately ran out of skill and/or patients.</p><p>What I really needed was a USB controller to be permanently pass through to the VM. Then, whenever a device was plugged into that USB controller, it would be connecting to the VM and never the Unraid host. And so then next issue (which we are about to solve), which USB controller and how to pass it through?</p><h2 id=inateck-superspeed-4-ports-pci-e-to-usb-30>Inateck Superspeed 4 Ports PCI-E to USB 3.0<a hidden class=anchor aria-hidden=true href=#inateck-superspeed-4-ports-pci-e-to-usb-30>#</a></h2><p>I found the ‘Inateck Superspeed 4 Ports PCI-E to USB 3.0’ on <a href=https://www.amazon.co.uk/gp/product/B00B6ZCNGM/ title=https://www.amazon.co.uk/gp/product/B00B6ZCNGM/>Amazon</a> and took a bit of an educated guess on whether I would be able to pass it through. The supported card/controllers list is very thin on the ground.</p><p>Importantly, it used the Fresco FL1100 series chipset, which to the best of my reading, can be passed through to a VM. It is also popular with crypto mining for this reason.</p><h2 id=how-to-pass-through-the-usb-controller>How to pass through the USB controller<a hidden class=anchor aria-hidden=true href=#how-to-pass-through-the-usb-controller>#</a></h2><p><strong>Prerequisites:</strong></p><ul><li>A working VM</li><li>CPU and Bios that supports VT-d (and has it enabled)</li><li>USB pcie card</li></ul><h3 id=find-the-device-identifier>Find the device identifier<a hidden class=anchor aria-hidden=true href=#find-the-device-identifier>#</a></h3><p>With the USB card plugged in, we must first identify it. <strong>Sadly, I cannot confirm that this card will show up in its</strong> own IOMMU group as it did for me, so your mileage may vary. My card shows up in its own IOMMU group and I can see its ID: 1b73:1100.</p><p><img loading=lazy src="https://i1.wp.com/exitcode0.net/wp-content/uploads/2021/02/image-8.png?resize=774%2C75&amp;ssl=1" alt="Unraid USB Controller Passthrough - finding the FL100 USB chipset">
Fresco FL1100 USB Controller</p><h3 id=edt-boot-config>Edt Boot config<a hidden class=anchor aria-hidden=true href=#edt-boot-config>#</a></h3><p>Now we need to tell Unraid to ignore/backlist the device by its ID, so that it will be available for passthrough. Go to the Main page, and click on your flash device to start editing the Syslinux boot config:</p><p><img loading=lazy src="https://i2.wp.com/exitcode0.net/wp-content/uploads/2021/02/image-6.png?resize=162%2C122&amp;ssl=1" alt="Unraid USB Controller Passthrough - UNRAID system config">
<img loading=lazy src="https://i2.wp.com/exitcode0.net/wp-content/uploads/2021/02/image-7.png?resize=774%2C218&amp;ssl=1" alt="Unraid USB Controller Passthrough - UNRIAD system config editor">
Under ‘<em>kernel /bzimage</em>‘ paste the following line, replacing the ID with yours appropriately:</p><pre tabindex=0><code>  append initrd=/bzroot pci-stub.ids=1b73:1100
</code></pre><p><strong>Save</strong> this, then it is time to <strong>reboot</strong>.</p><h3 id=edit-the-vm>Edit the VM<a hidden class=anchor aria-hidden=true href=#edit-the-vm>#</a></h3><p>Now we can edit the VM (with it powered off) and add the pcie USB card:</p><p><img loading=lazy src="https://i1.wp.com/exitcode0.net/wp-content/uploads/2021/02/image-9.png?resize=711%2C163&amp;ssl=1" alt="Unraid USB Controller Passthrough - unriad VM options">
<strong>SUCCESS!</strong></p><p>You should now have true USB hot swap in your UNRAID VM. I have had this working reliably for a number of weeks at this point, the passthrough config survives a complete system reboot and UNRAID upgrades.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://exitcode0.net/tags/libvert/>Libvert</a></li><li><a href=https://exitcode0.net/tags/unraid/>UNRAID</a></li><li><a href=https://exitcode0.net/tags/usb-hot-swap/>USB Hot Swap</a></li></ul><nav class=paginav><a class=prev href=https://exitcode0.net/posts/honeygain-docker-compose-setup/><span class=title>« Prev</span><br><span>Honeygain docker-compose setup</span>
</a><a class=next href=https://exitcode0.net/posts/collect-bitcoin-price-data-with-python-and-coinbase/><span class=title>Next »</span><br><span>Collect bitcoin price data with python and Coinbase</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://exitcode0.net/>ExitCode0</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>