<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Collect bitcoin price data with python and Coinbase | ExitCode0</title>
<meta name=keywords content><meta name=description content="Cryptocurrencies have been back on the popular agenda lately, thanks mostly to the surging value of Bitcoin. I have been interested, but not massively invested in cryptocurrency for many years. If I had the courage to buy and hold all those years ago, I might be writing to you from a beach – I assure you, this is not the case! I have been getting into InfluxDB lately and its fantastic ability to store heaps of time series data."><meta name=author content="Tom"><link rel=canonical href=https://exitcode0.net/posts/collect-bitcoin-price-data-with-python-and-coinbase/><link crossorigin=anonymous href=/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z+V9+cO1A=" rel="preload stylesheet" as=style><link rel=icon href=https://exitcode0.net/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://exitcode0.net/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://exitcode0.net/favicon-32x32.png><link rel=apple-touch-icon href=https://exitcode0.net/apple-touch-icon.png><link rel=mask-icon href=https://exitcode0.net/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://exitcode0.net/posts/collect-bitcoin-price-data-with-python-and-coinbase/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7745507566538945" crossorigin=anonymous></script><script data-name=BMC-Widget data-cfasync=false src=https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js data-id=exit data-description="Support me on Buy me a coffee!" data-message="Buy me a coffee" data-color=#FF813F data-position=Right data-x_margin=18 data-y_margin=165></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-EDE9MPZR9T"></script><script>var doNotTrack=!1,dnt;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-EDE9MPZR9T")}</script><meta property="og:title" content="Collect bitcoin price data with python and Coinbase"><meta property="og:description" content="Cryptocurrencies have been back on the popular agenda lately, thanks mostly to the surging value of Bitcoin. I have been interested, but not massively invested in cryptocurrency for many years. If I had the courage to buy and hold all those years ago, I might be writing to you from a beach – I assure you, this is not the case! I have been getting into InfluxDB lately and its fantastic ability to store heaps of time series data."><meta property="og:type" content="article"><meta property="og:url" content="https://exitcode0.net/posts/collect-bitcoin-price-data-with-python-and-coinbase/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-02-02T18:53:21+00:00"><meta property="article:modified_time" content="2021-02-02T18:53:21+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Collect bitcoin price data with python and Coinbase"><meta name=twitter:description content="Cryptocurrencies have been back on the popular agenda lately, thanks mostly to the surging value of Bitcoin. I have been interested, but not massively invested in cryptocurrency for many years. If I had the courage to buy and hold all those years ago, I might be writing to you from a beach – I assure you, this is not the case! I have been getting into InfluxDB lately and its fantastic ability to store heaps of time series data."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://exitcode0.net/posts/"},{"@type":"ListItem","position":2,"name":"Collect bitcoin price data with python and Coinbase","item":"https://exitcode0.net/posts/collect-bitcoin-price-data-with-python-and-coinbase/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Collect bitcoin price data with python and Coinbase","name":"Collect bitcoin price data with python and Coinbase","description":"Cryptocurrencies have been back on the popular agenda lately, thanks mostly to the surging value of Bitcoin. I have been interested, but not massively invested in cryptocurrency for many years. If I had the courage to buy and hold all those years ago, I might be writing to you from a beach – I assure you, this is not the case! I have been getting into InfluxDB lately and its fantastic ability to store heaps of time series data.","keywords":[],"articleBody":"Cryptocurrencies have been back on the popular agenda lately, thanks mostly to the surging value of Bitcoin. I have been interested, but not massively invested in cryptocurrency for many years. If I had the courage to buy and hold all those years ago, I might be writing to you from a beach – I assure you, this is not the case! I have been getting into InfluxDB lately and its fantastic ability to store heaps of time series data. Well, using python and Coinbase, I am going to show you how to collect bitcoin (and other crypto assets) price data and store it in InfluxDB… then we are going to make some neat panels in Grafana to help us realise our data. This is going to be a longer write up than most, so here is here are links to each section:\nContents Table: Prerequisites Using the Coinbase API with python Writing to InfluxDB with python Creating Coinbase data panels in Grafana Ways to support this blog Prerequisites Before we can jump into programming, there are a number of boxes we need to check off.\nYou must have a Coinbase account. If not, consider using my referral link to get $10 free when you sign up and buy/sell $100 of crypto: https://www.coinbase.com/join/cockin_u Your programming environment has python3 and pip3 installed – pip3 will be used to install the Coinbase module: pip install coinbase You have InfluxDB and Grafana setup. There are a number of great tutorials out there on how to do this, here are some places to get started: Unraid – https://unraid.net/blog/ultimate-unraid-dashboard InfluxDB getting started guide, including docker setup – https://docs.influxdata.com/influxdb/v2.0/get-started/ Grafana setup guide – https://grafana.com/docs/grafana/latest/installation/ Using the Coinbase API with python Whist you can use the Coinbase API without an account there are rate-limiting restrictions, so if you want more representative, ‘live’ data, you will need to create a Coinbase account and apply for an API key:\nWhere to find API options in your Coinbase account For the purposes of what we are doing in this exercise, there is no need to give the API key anything more than read level access to our account:\nCoinbase API read permissions\nPython and Coinbase You can access the full Coinbase API reference here, but we will be focusing on getting price data: https://developers.coinbase.com/api/v2#prices\nBasic Python Request – BTC Buy Price USD from coinbase.wallet.client import Client client: Client(, ) price: client.get_buy_price(currency_pair: 'BTC-USD') Basic Response – BTC Buy Price USD { \"data\": { \"amount\": \"1020.25\", \"currency\": \"USD\" } } So now that we have the basics from the Coinbase API reference, let us flesh this out into something more reliable and error-proof. Now is also a great time to make this into a function and call it continuously to gather time-series data.\nImproved Python Request The main function, giving us a continuous loop and skipping sending data when a Coinbase API request fails (checking for BTC and ETH):\nimport requests import sys import os import json from time import sleep from coinbase.wallet.client import Client def main(): timer: 0 timer_stop: 120 portfolio_total: 0 coins: [\"BTC\", \"ETH\"] while True: for coin in coins: reqdvalue: func_req_price(coin, 'USD', 'sell') if reqdvalue != False: func_logPrice(coin, reqdvalue, 'USD-sell') reqdvalue: func_req_price(coin, 'USD', 'buy') if reqdvalue != False: func_logPrice(coin, reqdvalue, 'USD-buy') sleep(5) A function to get the price data for a provided coin and kind (please note that we DON’T actually need an API key for this particular method):\ndef func_req_price(coin, currency, kind): try: price: float(requests.get( f'https://api.coinbase.com/v2/prices/{coin}-{currency}/{kind}' ).json()['data']['amount']) return price except: print(\"Error getting price for: {}\".format(coin)) return False This returns a price value or false if the request failed for any reason.\nWe now have three values – coin, kind (USD buy/sell) and price) – which we can throw into InfluxDB…\nIMPORTANT NOTE: If you are requesting data more frequently from Coinbase or you are pulling data for far more than just BTC and ETH, you will run into rate limits and receive error 429 responses for your requests. This is way Coinbase suggest using the API supported method of getting prices:\nfrom coinbase.wallet.client import Client client: Client(, ) price: client.get_buy_price(currency_pair: 'BTC-USD') 3 – Writing to InfluxDB with python I have covered most of the groundwork for this section already in this post: https://exitcode0.net/writing-to-an-influxdb-server-with-python3/.\nGeneric InfluxDB example from datetime import datetime from influxdb import InfluxDBClient def func_log(unit, kind, value): client: InfluxDBClient(host='127.0.0.1', port=8086) client.create_database('DBname') client.switch_database('DBname') json_body: [ { \"measurement\": \"MeasureName\", \"tags\": { \"unit\": unit, \"kind\": kind }, \"fields\": { \"value\": value }, \"time\": f'{datetime.utcnow().isoformat()}Z' } ] try: if client.write_points(json_body): success: True else: print(\"Error writing to InfluxDB\") except: print(\"Error writing to InfluxDB\") #Call the above function: func_log(unit, kind, value) Coinbase specific InfluxDB example def func_logPrice(coin, price, kind): client: InfluxDBClient(host='127.0.0.1', port=8086) client.switch_database('PyDCA') json_body: [ { \"measurement\": \"stability\", \"tags\": { \"coin\": f'{coin}', # e.g. BTC \"kind\": f'{kind}' #e.g. USD-sell }, \"fields\": { \"price\": price }, \"time\": f'{datetime.utcnow().isoformat()}Z' } ] try: if client.write_points(json_body): #do nothing success: True else: print(\"ERROR writing to InfluxDB\") except: print(\"ERROR writing to InfluxDB\") Combining all this code, we can pass any value that we retrieve from the Coinbase API and store it in InfluxDB with a time stamp. This will be very useful when we start creating panels in Grafana!\n4 – Creating Coinbase data panels in Grafana In my last segment of code, you can see that I specify the PyDCA data group when writing to influxDX, remember to set this accordingly in your code and Grafana panels.\nHere is a basic query to display BTC and ETH, USD sell prices as a time series graph; I have set ETH on the right-hand axis as the two values differ so greatly, bring the graphs into a tighter range:\nA basic Grafana time series query Showing the USD sell price provided by the Coinbase API API data flat spot As you can see from the above figure, there are some gaps in our data, this can be caused by a lack of response from the Coinbase API request, an API limit, or a failure to write to the InfluxDB. In my experience, this is a frequent occurrence for BTC and ETC prices in USD; most probably because it is the most popular API endpoint. I do not see correlating flat spots in the data for GBP. In Grafana we can make smooth the graph out by setting the GROUP BY: fill(none) tag. Grafana draws a neat line between data points where there is NULL data.\n5 – Ways to support this blog As previously mentioned, if you are new to Coinbase, you can sign up with my referral link. If you do so, you will receive $10 and so will I (You'll both get free Bitcoin when a friend buys or sells $100 of crypto – Coinbase).\nhttps://www.coinbase.com/join/cockin_u\nAlternatively, you can fund my coffee misadventures by throwing a coin in the tip jar:\nFREE BONUS: Alternatively, you can share this post or leave a comment below to let the search algorithms know I’m not totally useless.\nSee you on the moon HODLers!\n","wordCount":"1161","inLanguage":"en","datePublished":"2021-02-02T18:53:21Z","dateModified":"2021-02-02T18:53:21Z","author":{"@type":"Person","name":"Tom"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://exitcode0.net/posts/collect-bitcoin-price-data-with-python-and-coinbase/"},"publisher":{"@type":"Organization","name":"ExitCode0","logo":{"@type":"ImageObject","url":"https://exitcode0.net/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://exitcode0.net/ accesskey=h title="ExitCode0 (Alt + H)">ExitCode0</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://datasolace.com/ title=DataSolace><span>DataSolace</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=https://exitcode0.net/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://exitcode0.net/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://exitcode0.net/privacy/ title=Privacy><span>Privacy</span></a></li><li><a href=https://exitcode0.net/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://exitcode0.net/>Home</a>&nbsp;»&nbsp;<a href=https://exitcode0.net/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Collect bitcoin price data with python and Coinbase</h1><div class=post-meta><span title='2021-02-02 18:53:21 +0000 UTC'>February 2, 2021</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;Tom</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#contents-table aria-label="Contents Table:">Contents Table:</a></li><li><a href=#prerequisites aria-label=Prerequisites>Prerequisites</a></li><li><a href=#using-the-coinbase-api-with-python aria-label="Using the Coinbase API with python">Using the Coinbase API with python</a><ul><li><a href=#python-and-coinbase aria-label="Python and Coinbase">Python and Coinbase</a><ul><li><a href=#basic-python-request--btc-buy-price-usd aria-label="Basic Python Request – BTC Buy Price USD">Basic Python Request – BTC Buy Price USD</a></li><li><a href=#basic-response--btc-buy-price-usd aria-label="Basic Response – BTC Buy Price USD">Basic Response – BTC Buy Price USD</a></li><li><a href=#improved-python-request aria-label="Improved Python Request">Improved Python Request</a></li></ul></li></ul></li><li><a href=#3--writing-to-influxdb-with-python aria-label="3 – Writing to InfluxDB with python">3 – Writing to InfluxDB with python</a><ul><ul><li><a href=#generic-influxdb-example aria-label="Generic InfluxDB example">Generic InfluxDB example</a></li><li><a href=#coinbase-specific-influxdb-example aria-label="Coinbase specific InfluxDB example">Coinbase specific InfluxDB example</a></li></ul></ul></li><li><a href=#4--creating-coinbase-data-panels-in-grafana aria-label="4 – Creating Coinbase data panels in Grafana">4 – Creating Coinbase data panels in Grafana</a></li><li><a href=#5--ways-to-support-this-blog aria-label="5 – Ways to support this blog">5 – Ways to support this blog</a></li></ul></div></details></div><div class=post-content><p>Cryptocurrencies have been back on the popular agenda lately, thanks mostly to the surging value of Bitcoin. I have been interested, but not massively invested in cryptocurrency for many years. If I had the courage to buy and hold all those years ago, I might be writing to you from a beach – I assure you, this is not the case! I have been <a href=https://exitcode0.net/writing-to-an-influxdb-server-with-python3/ title=https://exitcode0.net/writing-to-an-influxdb-server-with-python3/>getting into InfluxDB lately</a> and its fantastic ability to store heaps of time series data. Well, using python and Coinbase, I am going to show you how to collect bitcoin (and other crypto assets) price data and store it in InfluxDB… then we are going to make some neat panels in Grafana to help us realise our data. This is going to be a longer write up than most, so here is here are links to each section:</p><h2 id=contents-table>Contents Table:<a hidden class=anchor aria-hidden=true href=#contents-table>#</a></h2><ol><li><a href=#Prerequisites title=#Prerequisites>Prerequisites</a></li><li><a href=#Using-the-Coinbase-API-with-python title=#Using-the-Coinbase-API-with-python>Using the Coinbase API with python</a></li><li><a href=#Writing-to-InfluxDB-with-python title=#Writing-to-InfluxDB-with-python>Writing to InfluxDB with python</a></li><li><a href=#Creating-Coinbase-data-panels-in-Grafana title=#Creating-Coinbase-data-panels-in-Grafana>Creating Coinbase data panels in Grafana</a></li><li><a href=#Ways-to-support-this-blog title=#Ways-to-support-this-blog>Ways to support this blog</a></li></ol><h2 id=prerequisites>Prerequisites<a hidden class=anchor aria-hidden=true href=#prerequisites>#</a></h2><p>Before we can jump into programming, there are a number of boxes we need to check off.</p><ol><li>You must have a Coinbase account. If not, consider using my referral link to get $10 free when you sign up and buy/sell $100 of crypto: <a href=https://www.coinbase.com/join/cockin>https://www.coinbase.com/join/cockin</a>_u</li><li>Your programming environment has python3 and pip3 installed – pip3 will be used to install the Coinbase module: <code>pip install coinbase</code></li><li>You have InfluxDB and Grafana setup. There are a number of great tutorials out there on how to do this, here are some places to get started:<ol><li>Unraid – <a href=https://unraid.net/blog/ultimate-unraid-dashboard>https://unraid.net/blog/ultimate-unraid-dashboard</a></li><li>InfluxDB getting started guide, including docker setup – <a href=https://docs.influxdata.com/influxdb/v2.0/get-started/ title=https://docs.influxdata.com/influxdb/v2.0/get-started/>https://docs.influxdata.com/influxdb/v2.0/get-started/</a></li><li>Grafana setup guide – <a href=https://grafana.com/docs/grafana/latest/installation/ title=https://grafana.com/docs/grafana/latest/installation/>https://grafana.com/docs/grafana/latest/installation/</a></li></ol></li></ol><h2 id=using-the-coinbase-api-with-python>Using the Coinbase API with python<a hidden class=anchor aria-hidden=true href=#using-the-coinbase-api-with-python>#</a></h2><p>Whist you can use the Coinbase API without an account there are rate-limiting restrictions, so if you want more representative, ‘live’ data, you will need to create a Coinbase account and apply for an API key:</p><p><img loading=lazy src="https://i2.wp.com/exitcode0.net/wp-content/uploads/2021/02/image-4-1024x80.png?resize=774%2C60&amp;ssl=1" alt="python and Coinbase - Coinbase API location">
Where to find API options in your Coinbase account
For the purposes of what we are doing in this exercise, there is no need to give the API key anything more than read level access to our account:</p><p><img loading=lazy src="https://i0.wp.com/exitcode0.net/wp-content/uploads/2021/02/image-5.png?resize=774%2C197&amp;ssl=1" alt="python and Coinbase - Coinbase API settings">
Coinbase API read permissions</p><h3 id=python-and-coinbase>Python and Coinbase<a hidden class=anchor aria-hidden=true href=#python-and-coinbase>#</a></h3><p>You can access the full Coinbase API reference here, but we will be focusing on getting price data: <a href=https://developers.coinbase.com/api/v2#prices title=https://developers.coinbase.com/api/v2#prices>https://developers.coinbase.com/api/v2#prices</a></p><h4 id=basic-python-request--btc-buy-price-usd>Basic Python Request – BTC Buy Price USD<a hidden class=anchor aria-hidden=true href=#basic-python-request--btc-buy-price-usd>#</a></h4><pre tabindex=0><code>
from coinbase.wallet.client import Client
client: Client(&lt;api_key&gt;, &lt;api_secret&gt;)

price: client.get_buy_price(currency_pair: &#39;BTC-USD&#39;)
</code></pre><h4 id=basic-response--btc-buy-price-usd>Basic Response – BTC Buy Price USD<a hidden class=anchor aria-hidden=true href=#basic-response--btc-buy-price-usd>#</a></h4><pre tabindex=0><code>{
  &#34;data&#34;: {
    &#34;amount&#34;: &#34;1020.25&#34;,
    &#34;currency&#34;: &#34;USD&#34;
  }
}
</code></pre><p>So now that we have the basics from the Coinbase API reference, let us flesh this out into something more reliable and error-proof. Now is also a great time to make this into a function and call it continuously to gather time-series data.</p><h4 id=improved-python-request>Improved Python Request<a hidden class=anchor aria-hidden=true href=#improved-python-request>#</a></h4><p>The main function, giving us a continuous loop and skipping sending data when a Coinbase API request fails (checking for BTC and ETH):</p><pre tabindex=0><code>import requests
import sys
import os
import json
from time import sleep
from coinbase.wallet.client import Client

def main():
    timer: 0
    timer_stop: 120
    portfolio_total: 0
    coins: [&#34;BTC&#34;, &#34;ETH&#34;]
    while True:
        for coin in coins:
            reqdvalue: func_req_price(coin, &#39;USD&#39;, &#39;sell&#39;)
            if reqdvalue != False:
                func_logPrice(coin, reqdvalue, &#39;USD-sell&#39;)

            reqdvalue: func_req_price(coin, &#39;USD&#39;, &#39;buy&#39;)
            if reqdvalue != False:
                func_logPrice(coin, reqdvalue, &#39;USD-buy&#39;)

        sleep(5)
</code></pre><p>A function to get the price data for a provided coin and kind (please note that we DON’T actually need an API key for this particular method):</p><pre tabindex=0><code>def func_req_price(coin, currency, kind):
    try:
        price: float(requests.get(
                f&#39;https://api.coinbase.com/v2/prices/{coin}-{currency}/{kind}&#39;
                ).json()[&#39;data&#39;][&#39;amount&#39;])
        return price
    except:
        print(&#34;Error getting price for: {}&#34;.format(coin))
        return False
</code></pre><p>This returns a price value or false if the request failed for any reason.<br>We now have three values – coin, kind (USD buy/sell) and price) – which we can throw into InfluxDB…</p><hr><p><strong>IMPORTANT NOTE:</strong> If you are requesting data more frequently from Coinbase or you are pulling data for far more than just BTC and ETH, you <strong>will</strong> run into rate limits and receive error 429 responses for your requests. This is way Coinbase suggest using the API supported method of getting prices:</p><pre tabindex=0><code>from coinbase.wallet.client import Client
client: Client(&lt;api_key&gt;, &lt;api_secret&gt;)

price: client.get_buy_price(currency_pair: &#39;BTC-USD&#39;)
</code></pre><hr><h2 id=3--writing-to-influxdb-with-python>3 – Writing to InfluxDB with python<a hidden class=anchor aria-hidden=true href=#3--writing-to-influxdb-with-python>#</a></h2><p>I have covered most of the groundwork for this section already in this post: <a href=https://exitcode0.net/writing-to-an-influxdb-server-with-python3/ title=https://exitcode0.net/writing-to-an-influxdb-server-with-python3/>https://exitcode0.net/writing-to-an-influxdb-server-with-python3/</a>.</p><h4 id=generic-influxdb-example>Generic InfluxDB example<a hidden class=anchor aria-hidden=true href=#generic-influxdb-example>#</a></h4><pre tabindex=0><code>from datetime import datetime
from influxdb import InfluxDBClient

def func_log(unit, kind, value):
	client: InfluxDBClient(host=&#39;127.0.0.1&#39;, port=8086)
	client.create_database(&#39;DBname&#39;)
	client.switch_database(&#39;DBname&#39;)
	json_body: [
		{
			&#34;measurement&#34;: &#34;MeasureName&#34;,
			&#34;tags&#34;: {
				&#34;unit&#34;: unit,
				&#34;kind&#34;: kind

			},
			&#34;fields&#34;: {
				&#34;value&#34;: value
			},
			&#34;time&#34;: f&#39;{datetime.utcnow().isoformat()}Z&#39;
		}
	]

	try:
		if client.write_points(json_body):
			success: True
		else:
			print(&#34;Error writing to InfluxDB&#34;)
	except:
		print(&#34;Error writing to InfluxDB&#34;)

#Call the above function:
func_log(unit, kind, value)
</code></pre><h4 id=coinbase-specific-influxdb-example>Coinbase specific InfluxDB example<a hidden class=anchor aria-hidden=true href=#coinbase-specific-influxdb-example>#</a></h4><pre tabindex=0><code>def func_logPrice(coin, price, kind):
    client: InfluxDBClient(host=&#39;127.0.0.1&#39;, port=8086)
    client.switch_database(&#39;PyDCA&#39;)

    json_body: [
        {
            &#34;measurement&#34;: &#34;stability&#34;,
            &#34;tags&#34;: {
                &#34;coin&#34;: f&#39;{coin}&#39;, # e.g. BTC
                &#34;kind&#34;: f&#39;{kind}&#39; #e.g. USD-sell
            },
            &#34;fields&#34;: {
                &#34;price&#34;: price
            },
            &#34;time&#34;: f&#39;{datetime.utcnow().isoformat()}Z&#39;
        }
    ]

    try:
        if client.write_points(json_body):
            #do nothing
            success: True
        else:
            print(&#34;ERROR writing to InfluxDB&#34;)
    except:
        print(&#34;ERROR writing to InfluxDB&#34;)
</code></pre><p>Combining all this code, we can pass any value that we retrieve from the Coinbase API and store it in InfluxDB with a time stamp. This will be very useful when we start creating panels in Grafana!</p><h2 id=4--creating-coinbase-data-panels-in-grafana>4 – Creating Coinbase data panels in Grafana<a hidden class=anchor aria-hidden=true href=#4--creating-coinbase-data-panels-in-grafana>#</a></h2><p>In my last segment of code, you can see that I specify the PyDCA data group when writing to influxDX, remember to set this accordingly in your code and Grafana panels.</p><p>Here is a basic query to display BTC and ETH, USD sell prices as a time series graph; I have set ETH on the right-hand axis as the two values differ so greatly, bring the graphs into a tighter range:</p><p><img loading=lazy src="https://i0.wp.com/exitcode0.net/wp-content/uploads/2021/02/image-3.png?resize=610%2C316&amp;ssl=1" alt="python and Coinbase - grafana coinbase query">
A basic Grafana time series query
<img loading=lazy src="https://i1.wp.com/exitcode0.net/wp-content/uploads/2021/02/image-1-1024x516.png?resize=774%2C390&amp;ssl=1" alt="python and Coinbase - grafana coinbase example">
Showing the USD sell price provided by the Coinbase API
<img loading=lazy src="https://i0.wp.com/exitcode0.net/wp-content/uploads/2021/02/image-2.png?resize=219%2C199&amp;ssl=1" alt="python and Coinbase - grafana fill null data">
API data flat spot
As you can see from the above figure, there are some gaps in our data, this can be caused by a lack of response from the Coinbase API request, an API limit, or a failure to write to the InfluxDB. In my experience, this is a frequent occurrence for BTC and ETC prices in USD; most probably because it is the most popular API endpoint. I do not see correlating flat spots in the data for GBP. In Grafana we can make smooth the graph out by setting the <code>GROUP BY: fill(none)</code> tag. Grafana draws a neat line between data points where there is NULL data.</p><h2 id=5--ways-to-support-this-blog>5 – Ways to support this blog<a hidden class=anchor aria-hidden=true href=#5--ways-to-support-this-blog>#</a></h2><p>As previously mentioned, if you are new to Coinbase, you can sign up with my referral link. If you do so, you will receive $10 and so will I (<code>You'll both get free Bitcoin when a friend buys or sells $100 of crypto</code> – Coinbase).<br><a href=https://www.coinbase.com/join/cockin_u title=https://www.coinbase.com/join/cockin_u>https://www.coinbase.com/join/cockin_u</a></p><p>Alternatively, you can fund my coffee misadventures by throwing a coin in the tip jar:</p><p><a href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&amp;hosted_button_id=BTQD4GN8TTWJN&amp;source=url" title="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&amp;hosted_button_id=BTQD4GN8TTWJN&amp;source=url"><img loading=lazy src="https://i0.wp.com/exitcode0.net/wp-content/uploads/2019/06/tipjar.png?resize=180%2C220" alt="ExitCode0 tip jar">
</a><strong>FREE BONUS:</strong> Alternatively, you can share this post or leave a comment below to let the search algorithms know I’m not totally useless.</p><p><img loading=lazy src="https://i1.wp.com/exitcode0.net/wp-content/uploads/2021/02/image.png?resize=542%2C470&amp;ssl=1" alt="python and Coinbase - #bitcoin to the moon">
See you on the moon HODLers!</p></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://exitcode0.net/posts/unraid-usb-controller-passthrough-vm-hot-swap-usb/><span class=title>« Prev</span><br><span>Unraid USB Controller Passthrough - VM hot swap USB</span>
</a><a class=next href=https://exitcode0.net/posts/writing-to-an-influxdb-server-with-python3/><span class=title>Next »</span><br><span>Writing to an InfluxDB server with Python3</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Collect bitcoin price data with python and Coinbase on x" href="https://x.com/intent/tweet/?text=Collect%20bitcoin%20price%20data%20with%20python%20and%20Coinbase&amp;url=https%3a%2f%2fexitcode0.net%2fposts%2fcollect-bitcoin-price-data-with-python-and-coinbase%2f&amp;hashtags="><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Collect bitcoin price data with python and Coinbase on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fexitcode0.net%2fposts%2fcollect-bitcoin-price-data-with-python-and-coinbase%2f&amp;title=Collect%20bitcoin%20price%20data%20with%20python%20and%20Coinbase&amp;summary=Collect%20bitcoin%20price%20data%20with%20python%20and%20Coinbase&amp;source=https%3a%2f%2fexitcode0.net%2fposts%2fcollect-bitcoin-price-data-with-python-and-coinbase%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Collect bitcoin price data with python and Coinbase on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fexitcode0.net%2fposts%2fcollect-bitcoin-price-data-with-python-and-coinbase%2f&title=Collect%20bitcoin%20price%20data%20with%20python%20and%20Coinbase"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Collect bitcoin price data with python and Coinbase on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fexitcode0.net%2fposts%2fcollect-bitcoin-price-data-with-python-and-coinbase%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Collect bitcoin price data with python and Coinbase on whatsapp" href="https://api.whatsapp.com/send?text=Collect%20bitcoin%20price%20data%20with%20python%20and%20Coinbase%20-%20https%3a%2f%2fexitcode0.net%2fposts%2fcollect-bitcoin-price-data-with-python-and-coinbase%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Collect bitcoin price data with python and Coinbase on telegram" href="https://telegram.me/share/url?text=Collect%20bitcoin%20price%20data%20with%20python%20and%20Coinbase&amp;url=https%3a%2f%2fexitcode0.net%2fposts%2fcollect-bitcoin-price-data-with-python-and-coinbase%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Collect bitcoin price data with python and Coinbase on ycombinator" href="https://news.ycombinator.com/submitlink?t=Collect%20bitcoin%20price%20data%20with%20python%20and%20Coinbase&u=https%3a%2f%2fexitcode0.net%2fposts%2fcollect-bitcoin-price-data-with-python-and-coinbase%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://exitcode0.net/>ExitCode0</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>