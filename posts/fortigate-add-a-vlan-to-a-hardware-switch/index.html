<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Fortigate: Add a VLAN to a hardware switch | ExitCode0</title>
<meta name=keywords content="fortigate,networking,VLANs"><meta name=description content="

In this post, we are going to discuss how to add a VLAN to a hardware (sometimes referred to as physical) switch or interface on a Fortigate. It is worth noting that I actually do my testing on a FortiWifi, so I can assure you that this also applies there too. I will be focusing on the configuration which is relevant to FortiOS v6.0 and above, so your millage vary between versions. However, you need can usually be found over at the Fortinet Handbook: https://docs.fortinet.com/product/fortigate/6.0."><meta name=author content="Tom"><link rel=canonical href=https://exitcode0.net/posts/fortigate-add-a-vlan-to-a-hardware-switch/><link crossorigin=anonymous href=/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z+V9+cO1A=" rel="preload stylesheet" as=style><link rel=icon href=https://exitcode0.net/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://exitcode0.net/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://exitcode0.net/favicon-32x32.png><link rel=apple-touch-icon href=https://exitcode0.net/apple-touch-icon.png><link rel=mask-icon href=https://exitcode0.net/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://exitcode0.net/posts/fortigate-add-a-vlan-to-a-hardware-switch/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7745507566538945" crossorigin=anonymous></script><script data-name=BMC-Widget data-cfasync=false src=https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js data-id=exit data-description="Support me on Buy me a coffee!" data-message="Buy me a coffee" data-color=#FF813F data-position=Right data-x_margin=18 data-y_margin=165></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-EDE9MPZR9T"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-EDE9MPZR9T")}</script><meta property="og:title" content="Fortigate: Add a VLAN to a hardware switch"><meta property="og:description" content="

In this post, we are going to discuss how to add a VLAN to a hardware (sometimes referred to as physical) switch or interface on a Fortigate. It is worth noting that I actually do my testing on a FortiWifi, so I can assure you that this also applies there too. I will be focusing on the configuration which is relevant to FortiOS v6.0 and above, so your millage vary between versions. However, you need can usually be found over at the Fortinet Handbook: https://docs.fortinet.com/product/fortigate/6.0."><meta property="og:type" content="article"><meta property="og:url" content="https://exitcode0.net/posts/fortigate-add-a-vlan-to-a-hardware-switch/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-01-09T21:30:54+00:00"><meta property="article:modified_time" content="2021-01-09T21:30:54+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Fortigate: Add a VLAN to a hardware switch"><meta name=twitter:description content="

In this post, we are going to discuss how to add a VLAN to a hardware (sometimes referred to as physical) switch or interface on a Fortigate. It is worth noting that I actually do my testing on a FortiWifi, so I can assure you that this also applies there too. I will be focusing on the configuration which is relevant to FortiOS v6.0 and above, so your millage vary between versions. However, you need can usually be found over at the Fortinet Handbook: https://docs.fortinet.com/product/fortigate/6.0."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://exitcode0.net/posts/"},{"@type":"ListItem","position":2,"name":"Fortigate: Add a VLAN to a hardware switch","item":"https://exitcode0.net/posts/fortigate-add-a-vlan-to-a-hardware-switch/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Fortigate: Add a VLAN to a hardware switch","name":"Fortigate: Add a VLAN to a hardware switch","description":" In this post, we are going to discuss how to add a VLAN to a hardware (sometimes referred to as physical) switch or interface on a Fortigate. It is worth noting that I actually do my testing on a FortiWifi, so I can assure you that this also applies there too. I will be focusing on the configuration which is relevant to FortiOS v6.0 and above, so your millage vary between versions. However, you need can usually be found over at the Fortinet Handbook: https://docs.fortinet.com/product/fortigate/6.0.\n","keywords":["fortigate","networking","VLANs"],"articleBody":" In this post, we are going to discuss how to add a VLAN to a hardware (sometimes referred to as physical) switch or interface on a Fortigate. It is worth noting that I actually do my testing on a FortiWifi, so I can assure you that this also applies there too. I will be focusing on the configuration which is relevant to FortiOS v6.0 and above, so your millage vary between versions. However, you need can usually be found over at the Fortinet Handbook: https://docs.fortinet.com/product/fortigate/6.0.\nSwitch mode Vs Interface Mode I’m not going to get too far into the minutia of switch vs interface mode. There are many arguments for both and I believe that the correct answer is very much dependant on your intended implementation. I have my Fortigate 60E configured in interface mode, with most of my LAN ports, 2-7, configured in a hardware switch. This hardware switch is operating in what you may class as the default VLAN. Most of the configuration which we are going to discuss is basic and will apply to a Fortigate in (software) switch mode. I will try my best to point out any obvious configuration differences where they may arise.\nVLANs in NAT mode It is important to mention that I have my Fortigate 60E running in NAT mode. In NAT mode, the FortiGate supports VLAN trunk links with IEEE 802.1Q‑compliant switches or routers. The trunk link transports VLAN-tagged packets between physical subnets or networks. When you add VLAN sub-interfaces to the FortiGate physical interfaces, the VLANs have IDs that match the VLAN IDs of packets on the trunk link. The FortiGate directs packets with VLAN IDs to sub‑interfaces with matching IDs.\nWhereas in Transparent mode, the Fortigate behaves like a layer-2 bridge but it can still provide services such as antivirus scanning, web filtering, spam filtering, and intrusion protection to traffic. There are some limitations in transparent mode because you can’t use SSL VPN, PPTP/L2TP VPN, DHCP server, or easily perform NAT on traffic. The limits in transparent mode apply to IEEE 802.1Q VLAN trunks passing through the device.\nFortigate VLAN Config Example Physical Switch Config I will start by splitting an interface out of the default hardware switch. I am chosing to do this because I want to preseve the rest of the LAN ports for use in my ‘regular’ LAN. Interface LAN1 will be used for VLANs and connected to a managed switch whih supports VLANs.\nTwo hardware switches – one with VLANs The reality of having ‘two hardware switches’ is that the Fortigate created two virtual-switches, nested under one physical-switch. This is easily demonstrated in the subsequent config:\nconfig system physical-switch edit \"sw0\" set age-val 0 next end config system virtual-switch edit \"internal\" set physical-switch \"sw0\" config port edit \"internal2\" next edit \"internal3\" next edit \"internal4\" next edit \"internal5\" next edit \"internal6\" next edit \"internal7\" next end next edit \"VTRUNK\" set physical-switch \"sw0\" config port edit \"internal1\" next end next end VLAN Config Now that we have split out our hardware switches, we can start adding VLANs. Enabling a DHCP server on a VLAN is optional, but I have no alternatives in my home network and most of the devices I plan to isolate in my VLANs can be troublesome to set static addresses on.\nBasic VLAN config on a hardware switch It is worth noting that, I did not enable a DHCP server on my LAN1 interface, so if my device is connected and does not have a valid VLAN tag set, it will be assigned an IP address. I named internal1 one to reflect that it will be used as a trunk port for the traffic of multiple VLANs to be carried over to a managed switch. Here is the CLI config for each of my VLAN interfaces:\nconfig system interface edit \"internal\" set vdom \"root\" set ip ---.---.---.--- ---.---.---.--- set allowaccess ping https ssh set type hard-switch set alias \"LAN\" set stp enable set snmp-index 6 next edit \"VTRUNK\" set vdom \"root\" set ip 172.16.30.1 255.255.255.0 set allowaccess ping set type hard-switch set description \"VLAN TRUNK\" set alias \"VLAN TRUNK\" set device-identification enable set lldp-transmission enable set role lan set snmp-index 11 next edit \"V31-IoT\" set vdom \"root\" set ip 172.16.31.1 255.255.255.0 set allowaccess ping set description \"VLAN IoT\" set alias \"VLAN IoT\" set device-identification enable set role lan set snmp-index 10 set interface \"VTRUNK\" set vlanid 31 next edit \"V32-Hue\" set vdom \"root\" set ip 172.16.32.1 255.255.255.0 set allowaccess ping set description \"VLAN32 Hue\" set alias \"VLAN Hue\" set device-identification enable set role lan set snmp-index 12 set interface \"VTRUNK\" set vlanid 32 next end ","wordCount":"772","inLanguage":"en","datePublished":"2021-01-09T21:30:54Z","dateModified":"2021-01-09T21:30:54Z","author":{"@type":"Person","name":"Tom"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://exitcode0.net/posts/fortigate-add-a-vlan-to-a-hardware-switch/"},"publisher":{"@type":"Organization","name":"ExitCode0","logo":{"@type":"ImageObject","url":"https://exitcode0.net/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://exitcode0.net/ accesskey=h title="ExitCode0 (Alt + H)">ExitCode0</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://datasolace.com/ title=DataSolace><span>DataSolace</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=https://exitcode0.net/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://exitcode0.net/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://exitcode0.net/privacy/ title=Privacy><span>Privacy</span></a></li><li><a href=https://exitcode0.net/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://exitcode0.net/>Home</a>&nbsp;»&nbsp;<a href=https://exitcode0.net/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Fortigate: Add a VLAN to a hardware switch</h1><div class=post-meta><span title='2021-01-09 21:30:54 +0000 UTC'>January 9, 2021</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;Tom</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#switch-mode-vs-interface-mode aria-label="Switch mode Vs Interface Mode">Switch mode Vs Interface Mode</a></li><li><a href=#vlans-in-nat-mode aria-label="VLANs in NAT mode">VLANs in NAT mode</a></li><li><a href=#fortigate-vlan-config-example aria-label="Fortigate VLAN Config Example">Fortigate VLAN Config Example</a><ul><li><a href=#physical-switch-config aria-label="Physical Switch Config">Physical Switch Config</a></li><li><a href=#vlan-config aria-label="VLAN Config">VLAN Config</a></li></ul></li></ul></div></details></div><div class=post-content><p><img loading=lazy src="https://i1.wp.com/exitcode0.net/wp-content/uploads/2021/01/fortigate_VLANs-1024x1024.png?resize=227%2C227&amp;ssl=1" alt="Fortigate: Add a VLAN to a hardware switch - Configuration Example">
In this post, we are going to discuss how to add a VLAN to a hardware (sometimes referred to as physical) switch or interface on a Fortigate. It is worth noting that I actually do my testing on a FortiWifi, so I can assure you that this also applies there too. I will be focusing on the configuration which is relevant to FortiOS v6.0 and above, so your millage vary between versions. However, you need can usually be found over at the Fortinet Handbook: <a href=https://docs.fortinet.com/product/fortigate/6.0 title=https://docs.fortinet.com/product/fortigate/6.0>https://docs.fortinet.com/product/fortigate/6.0</a>.</p><h2 id=switch-mode-vs-interface-mode>Switch mode Vs Interface Mode<a hidden class=anchor aria-hidden=true href=#switch-mode-vs-interface-mode>#</a></h2><p>I’m not going to get too far into the minutia of switch vs interface mode. There are many arguments for both and I believe that the correct answer is very much dependant on your intended implementation. I have my Fortigate 60E configured in interface mode, with most of my LAN ports, 2-7, configured in a hardware switch. This hardware switch is operating in what you may class as the default VLAN. Most of the configuration which we are going to discuss is basic and will apply to a Fortigate in (software) switch mode. I will try my best to point out any obvious configuration differences where they may arise.</p><h2 id=vlans-in-nat-mode>VLANs in NAT mode<a hidden class=anchor aria-hidden=true href=#vlans-in-nat-mode>#</a></h2><p>It is important to mention that I have my Fortigate 60E running in NAT mode. In <strong>NAT</strong> mode, the FortiGate supports VLAN trunk links with IEEE 802.1Q‑compliant switches or routers. The trunk link transports VLAN-tagged packets between physical subnets or networks. When you add VLAN sub-interfaces to the FortiGate physical interfaces, the VLANs have IDs that match the VLAN IDs of packets on the trunk link. The FortiGate directs packets with VLAN IDs to sub‑interfaces with matching IDs.</p><p>Whereas in <strong>Transparent</strong> mode, the Fortigate behaves like a layer-2 bridge but it can still provide services such as antivirus scanning, web filtering, spam filtering, and intrusion protection to traffic. There are some limitations in transparent mode because you can’t use SSL VPN, PPTP/L2TP VPN, DHCP server, or easily perform NAT on traffic. The limits in transparent mode apply to IEEE 802.1Q VLAN trunks passing through the device.</p><h2 id=fortigate-vlan-config-example>Fortigate VLAN Config Example<a hidden class=anchor aria-hidden=true href=#fortigate-vlan-config-example>#</a></h2><h3 id=physical-switch-config>Physical Switch Config<a hidden class=anchor aria-hidden=true href=#physical-switch-config>#</a></h3><p>I will start by splitting an interface out of the default hardware switch. I am chosing to do this because I want to preseve the rest of the LAN ports for use in my ‘regular’ LAN. Interface LAN1 will be used for VLANs and connected to a managed switch whih supports VLANs.</p><p><img loading=lazy src="https://i2.wp.com/exitcode0.net/wp-content/uploads/2021/01/image-5.png?resize=774%2C343&amp;ssl=1" alt="Fortigate: Add a VLAN to a hardware switch - interface configuration">
Two hardware switches – one with VLANs
The reality of having ‘two hardware switches’ is that the Fortigate created two virtual-switches, nested under one physical-switch. This is easily demonstrated in the subsequent config:</p><pre tabindex=0><code>config system physical-switch
    edit &#34;sw0&#34;
        set age-val 0
    next
end
config system virtual-switch
    edit &#34;internal&#34;
        set physical-switch &#34;sw0&#34;
        config port
            edit &#34;internal2&#34;
            next
            edit &#34;internal3&#34;
            next
            edit &#34;internal4&#34;
            next
            edit &#34;internal5&#34;
            next
            edit &#34;internal6&#34;
            next
            edit &#34;internal7&#34;
            next
        end
    next
    edit &#34;VTRUNK&#34;
        set physical-switch &#34;sw0&#34;
        config port
            edit &#34;internal1&#34;
            next
        end
    next
end
</code></pre><h3 id=vlan-config>VLAN Config<a hidden class=anchor aria-hidden=true href=#vlan-config>#</a></h3><p>Now that we have split out our hardware switches, we can start adding VLANs. Enabling a DHCP server on a VLAN is optional, but I have no alternatives in my home network and most of the devices I plan to isolate in my VLANs can be troublesome to set static addresses on.</p><p><img loading=lazy src="https://i0.wp.com/exitcode0.net/wp-content/uploads/2021/01/image-4.png?resize=717%2C708&amp;ssl=1" alt="Fortigate: Add a VLAN to a hardware switch  -VLAN creation">
Basic VLAN config on a hardware switch
It is worth noting that, I did not enable a DHCP server on my LAN1 interface, so if my device is connected and does not have a valid VLAN tag set, it will be assigned an IP address. I named internal1 one to reflect that it will be used as a trunk port for the traffic of multiple VLANs to be carried over to a managed switch. Here is the CLI config for each of my VLAN interfaces:</p><pre tabindex=0><code>config system interface
    edit &#34;internal&#34;
        set vdom &#34;root&#34;
        set ip ---.---.---.--- ---.---.---.---
        set allowaccess ping https ssh
        set type hard-switch
        set alias &#34;LAN&#34;
        set stp enable
        set snmp-index 6
    next
    edit &#34;VTRUNK&#34;
        set vdom &#34;root&#34;
        set ip 172.16.30.1 255.255.255.0
        set allowaccess ping
        set type hard-switch
        set description &#34;VLAN TRUNK&#34;
        set alias &#34;VLAN TRUNK&#34;
        set device-identification enable
        set lldp-transmission enable
        set role lan
        set snmp-index 11
    next
    edit &#34;V31-IoT&#34;
        set vdom &#34;root&#34;
        set ip 172.16.31.1 255.255.255.0
        set allowaccess ping
        set description &#34;VLAN IoT&#34;
        set alias &#34;VLAN IoT&#34;
        set device-identification enable
        set role lan
        set snmp-index 10
        set interface &#34;VTRUNK&#34;
        set vlanid 31
    next
    edit &#34;V32-Hue&#34;
        set vdom &#34;root&#34;
        set ip 172.16.32.1 255.255.255.0
        set allowaccess ping
        set description &#34;VLAN32 Hue&#34;
        set alias &#34;VLAN Hue&#34;
        set device-identification enable
        set role lan
        set snmp-index 12
        set interface &#34;VTRUNK&#34;
        set vlanid 32
    next
end
</code></pre></div><footer class=post-footer><ul class=post-tags><li><a href=https://exitcode0.net/tags/fortigate/>Fortigate</a></li><li><a href=https://exitcode0.net/tags/networking/>Networking</a></li><li><a href=https://exitcode0.net/tags/vlans/>VLANs</a></li></ul><nav class=paginav><a class=prev href=https://exitcode0.net/posts/fortigate-ap-bridge-with-a-hardware-switch/><span class=title>« Prev</span><br><span>Fortigate: AP-Bridge with a hardware switch</span>
</a><a class=next href=https://exitcode0.net/posts/debian-10-how-to-upgrade-python-3-7-to-python-3-9/><span class=title>Next »</span><br><span>Debian 10 - How to upgrade python 3.7 to python 3.9</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://exitcode0.net/>ExitCode0</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>