<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Fortigate: AP-Bridge with a hardware switch | ExitCode0</title>
<meta name=keywords content="AP-Bridge,fortigate,VLANs"><meta name=description content="Following on from a previous post on how to setup a VLAN on a Fortigate hardware switch, this post is going to explain how we can link an AP-bridge SSID to a hardware switch and VLAN.
For the most part, the only reference material you will need to complete this configuration can be found here: https://docs.fortinet.com/document/fortiap/6.4.0/fortiwifi-and-fortiap-cookbook/252439/configuring-the-fortigate-interface-to-manage-fortiap-units. However, if you have been working with Fortigates and by extension FortiOS for quite some time, you may be wonder where the CAPWAP option vanished to? Fortinet adopted this into the security fabric naming convention. CAPWAP has even been replaced in the CLI by ‘fabric’."><meta name=author content="Tom"><link rel=canonical href=https://exitcode0.net/posts/fortigate-ap-bridge-with-a-hardware-switch/><link crossorigin=anonymous href=/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z+V9+cO1A=" rel="preload stylesheet" as=style><link rel=icon href=https://exitcode0.net/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://exitcode0.net/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://exitcode0.net/favicon-32x32.png><link rel=apple-touch-icon href=https://exitcode0.net/apple-touch-icon.png><link rel=mask-icon href=https://exitcode0.net/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://exitcode0.net/posts/fortigate-ap-bridge-with-a-hardware-switch/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7745507566538945" crossorigin=anonymous></script><script data-name=BMC-Widget data-cfasync=false src=https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js data-id=exit data-description="Support me on Buy me a coffee!" data-message="Buy me a coffee" data-color=#FF813F data-position=Right data-x_margin=18 data-y_margin=165></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-EDE9MPZR9T"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-EDE9MPZR9T")}</script><meta property="og:title" content="Fortigate: AP-Bridge with a hardware switch"><meta property="og:description" content="Following on from a previous post on how to setup a VLAN on a Fortigate hardware switch, this post is going to explain how we can link an AP-bridge SSID to a hardware switch and VLAN.
For the most part, the only reference material you will need to complete this configuration can be found here: https://docs.fortinet.com/document/fortiap/6.4.0/fortiwifi-and-fortiap-cookbook/252439/configuring-the-fortigate-interface-to-manage-fortiap-units. However, if you have been working with Fortigates and by extension FortiOS for quite some time, you may be wonder where the CAPWAP option vanished to? Fortinet adopted this into the security fabric naming convention. CAPWAP has even been replaced in the CLI by ‘fabric’."><meta property="og:type" content="article"><meta property="og:url" content="https://exitcode0.net/posts/fortigate-ap-bridge-with-a-hardware-switch/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-01-17T16:41:24+00:00"><meta property="article:modified_time" content="2021-01-17T16:41:24+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Fortigate: AP-Bridge with a hardware switch"><meta name=twitter:description content="Following on from a previous post on how to setup a VLAN on a Fortigate hardware switch, this post is going to explain how we can link an AP-bridge SSID to a hardware switch and VLAN.
For the most part, the only reference material you will need to complete this configuration can be found here: https://docs.fortinet.com/document/fortiap/6.4.0/fortiwifi-and-fortiap-cookbook/252439/configuring-the-fortigate-interface-to-manage-fortiap-units. However, if you have been working with Fortigates and by extension FortiOS for quite some time, you may be wonder where the CAPWAP option vanished to? Fortinet adopted this into the security fabric naming convention. CAPWAP has even been replaced in the CLI by ‘fabric’."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://exitcode0.net/posts/"},{"@type":"ListItem","position":2,"name":"Fortigate: AP-Bridge with a hardware switch","item":"https://exitcode0.net/posts/fortigate-ap-bridge-with-a-hardware-switch/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Fortigate: AP-Bridge with a hardware switch","name":"Fortigate: AP-Bridge with a hardware switch","description":"Following on from a previous post on how to setup a VLAN on a Fortigate hardware switch, this post is going to explain how we can link an AP-bridge SSID to a hardware switch and VLAN.\nFor the most part, the only reference material you will need to complete this configuration can be found here: https://docs.fortinet.com/document/fortiap/6.4.0/fortiwifi-and-fortiap-cookbook/252439/configuring-the-fortigate-interface-to-manage-fortiap-units. However, if you have been working with Fortigates and by extension FortiOS for quite some time, you may be wonder where the CAPWAP option vanished to? Fortinet adopted this into the security fabric naming convention. CAPWAP has even been replaced in the CLI by ‘fabric’.\n","keywords":["AP-Bridge","fortigate","VLANs"],"articleBody":"Following on from a previous post on how to setup a VLAN on a Fortigate hardware switch, this post is going to explain how we can link an AP-bridge SSID to a hardware switch and VLAN.\nFor the most part, the only reference material you will need to complete this configuration can be found here: https://docs.fortinet.com/document/fortiap/6.4.0/fortiwifi-and-fortiap-cookbook/252439/configuring-the-fortigate-interface-to-manage-fortiap-units. However, if you have been working with Fortigates and by extension FortiOS for quite some time, you may be wonder where the CAPWAP option vanished to? Fortinet adopted this into the security fabric naming convention. CAPWAP has even been replaced in the CLI by ‘fabric’.\nAP-Bridge with a VLAN The confif that I a looking to build will give me an SSID for a given VLAN; a client which is connected to this SSID wil be given a DHCP address and will be subject to firewall policy for that VLAN. The client will not be required to set their own VLAN tag – traffic will be tagged by the SSID interface.\nV33 is an AP-brige to VLAN 33 on the hardware switch. We are also going to have an SSID on the ‘default VLAN’ aka a typical wireless LAN – sharing the same subnet and multicast zone as the ports in our hardware switch.\nUltimately we will have an SSID which is isolated from all other ‘LAN’ traffic, perfect for wireless CCTVs cameras or IoT device which we don’t trust.\nThe Configuration Hardware Switch and VLAN Much of this configuration was covered in a previous post, see here: https://exitcode0.net/fortigate-add-a-vlan-to-a-hardware-switch.\nAt this point we will have a hardware switch and a VLAN assigned to it – VLAN 33.\nOne important change is to enabled security fabric management (previously CAPWAP) on our hardware switch:\nSecurity Fabric Connection is enabled – previous known as CAPWAP. If you choose to operate in the CLI, here is how you would implement this:\nconfig system interface edit LAN #(hardware switch name) set allow-access fabric set ap-discover enable next end SSID Configuration Setting traffic mode to AP-bridge and Optional VLAN ID to 33, we create an SSID with a suitabe BSSID and security settings as follows:\nan SSID for VLAN 33 In AP-bridge mode, all traffic on SSID V33 will be tunneled to the Fortigate’s security fabric controller and to the VLAN interface there onwards.\nAnd that is it! It really is that simple. It is worth mentioning, that this is also possible with a software switch, but not without significant throughput penalties – all switching passes through the the Fortigate’s CPU in a software switch.\n","wordCount":"425","inLanguage":"en","datePublished":"2021-01-17T16:41:24Z","dateModified":"2021-01-17T16:41:24Z","author":{"@type":"Person","name":"Tom"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://exitcode0.net/posts/fortigate-ap-bridge-with-a-hardware-switch/"},"publisher":{"@type":"Organization","name":"ExitCode0","logo":{"@type":"ImageObject","url":"https://exitcode0.net/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://exitcode0.net/ accesskey=h title="ExitCode0 (Alt + H)">ExitCode0</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://datasolace.com/ title=DataSolace><span>DataSolace</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=https://exitcode0.net/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://exitcode0.net/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://exitcode0.net/privacy/ title=Privacy><span>Privacy</span></a></li><li><a href=https://exitcode0.net/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://exitcode0.net/>Home</a>&nbsp;»&nbsp;<a href=https://exitcode0.net/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Fortigate: AP-Bridge with a hardware switch</h1><div class=post-meta><span title='2021-01-17 16:41:24 +0000 UTC'>January 17, 2021</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;Tom</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#ap-bridge-with-a-vlan aria-label="AP-Bridge with a VLAN">AP-Bridge with a VLAN</a></li><li><a href=#the-configuration aria-label="The Configuration">The Configuration</a><ul><li><a href=#hardware-switch-and-vlan aria-label="Hardware Switch and VLAN">Hardware Switch and VLAN</a></li><li><a href=#ssid-configuration aria-label="SSID Configuration">SSID Configuration</a></li></ul></li></ul></div></details></div><div class=post-content><p>Following on from a previous post on <a href=https://exitcode0.net/posts/fortigate-add-a-vlan-to-a-hardware-switch/ title=https://exitcode0.net/posts/fortigate-add-a-vlan-to-a-hardware-switch/>how to setup a VLAN on a Fortigate hardware switch</a>, this post is going to explain how we can link an AP-bridge SSID to a hardware switch and VLAN.</p><p>For the most part, the only reference material you will need to complete this configuration can be found here: <a href=https://docs.fortinet.com/document/fortiap/6.4.0/fortiwifi-and-fortiap-cookbook/252439/configuring-the-fortigate-interface-to-manage-fortiap-units title=https://docs.fortinet.com/document/fortiap/6.4.0/fortiwifi-and-fortiap-cookbook/252439/configuring-the-fortigate-interface-to-manage-fortiap-units>https://docs.fortinet.com/document/fortiap/6.4.0/fortiwifi-and-fortiap-cookbook/252439/configuring-the-fortigate-interface-to-manage-fortiap-units</a>. However, if you have been working with Fortigates and by extension FortiOS for quite some time, you may be wonder where the CAPWAP option vanished to? Fortinet adopted this into the security fabric naming convention. CAPWAP has even been replaced in the CLI by ‘fabric’.</p><h2 id=ap-bridge-with-a-vlan>AP-Bridge with a VLAN<a hidden class=anchor aria-hidden=true href=#ap-bridge-with-a-vlan>#</a></h2><p>The confif that I a looking to build will give me an SSID for a given VLAN; a client which is connected to this SSID wil be given a DHCP address and will be subject to firewall policy for that VLAN. The client will not be required to set their own VLAN tag – traffic will be tagged by the SSID interface.</p><p><img loading=lazy src="https://i2.wp.com/exitcode0.net/wp-content/uploads/2021/01/WLAN-hardwareswitch.png?resize=683%2C189&amp;ssl=1" alt="Fortigate: AP-Bridge with a hardware switch - topology example">
V33 is an AP-brige to VLAN 33 on the hardware switch.
We are also going to have an SSID on the ‘default VLAN’ aka a typical wireless LAN – sharing the same subnet and multicast zone as the ports in our hardware switch.</p><p>Ultimately we will have an SSID which is isolated from all other ‘LAN’ traffic, perfect for wireless CCTVs cameras or IoT device which we don’t trust.</p><h2 id=the-configuration>The Configuration<a hidden class=anchor aria-hidden=true href=#the-configuration>#</a></h2><h3 id=hardware-switch-and-vlan>Hardware Switch and VLAN<a hidden class=anchor aria-hidden=true href=#hardware-switch-and-vlan>#</a></h3><p>Much of this configuration was covered in a previous post, see here: <a href=https://exitcode0.net/posts/fortigate-add-a-vlan-to-a-hardware-switch/ title=https://exitcode0.net/posts/fortigate-add-a-vlan-to-a-hardware-switch/>https://exitcode0.net/fortigate-add-a-vlan-to-a-hardware-switch</a>.</p><p>At this point we will have a hardware switch and a VLAN assigned to it – VLAN 33.</p><p>One important change is to enabled security fabric management (previously CAPWAP) on our hardware switch:</p><p><img loading=lazy src="https://i2.wp.com/exitcode0.net/wp-content/uploads/2021/01/image-6.png?resize=615%2C118&amp;ssl=1" alt="Fortigate: AP-Bridge with a hardware switch - Security Fabric Connection - CAPWAP">
Security Fabric Connection is enabled – previous known as CAPWAP.
If you choose to operate in the CLI, here is how you would implement this:</p><pre tabindex=0><code>config system interface
edit LAN      #(hardware switch name)
set allow-access fabric
set ap-discover enable
next
end
</code></pre><h3 id=ssid-configuration>SSID Configuration<a hidden class=anchor aria-hidden=true href=#ssid-configuration>#</a></h3><p>Setting traffic mode to AP-bridge and Optional VLAN ID to 33, we create an SSID with a suitabe BSSID and security settings as follows:</p><p><img loading=lazy src="https://i0.wp.com/exitcode0.net/wp-content/uploads/2021/01/image-7.png?resize=774%2C654&amp;ssl=1" alt="Fortigate: AP-Bridge with a hardware switch - SSID configuration">
an SSID for VLAN 33
In AP-bridge mode, all traffic on SSID V33 will be tunneled to the Fortigate’s security fabric controller and to the VLAN interface there onwards.</p><p><strong>And that is it! It really is that simple.</strong> It is worth mentioning, that this is also possible with a software switch, but not without significant throughput penalties – all switching passes through the the Fortigate’s CPU in a software switch.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://exitcode0.net/tags/ap-bridge/>AP-Bridge</a></li><li><a href=https://exitcode0.net/tags/fortigate/>Fortigate</a></li><li><a href=https://exitcode0.net/tags/vlans/>VLANs</a></li></ul><nav class=paginav><a class=prev href=https://exitcode0.net/posts/writing-to-an-influxdb-server-with-python3/><span class=title>« Prev</span><br><span>Writing to an InfluxDB server with Python3</span>
</a><a class=next href=https://exitcode0.net/posts/fortigate-add-a-vlan-to-a-hardware-switch/><span class=title>Next »</span><br><span>Fortigate: Add a VLAN to a hardware switch</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://exitcode0.net/>ExitCode0</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>